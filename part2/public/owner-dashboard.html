<!-- ADD: Logout button in header section (add after <h1> tag) -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="text-primary">Owner Dashboard</h1>
  <div>
    <span class="me-3">Welcome, <strong>{{ currentUser.username }}</strong>!</span>
    <button @click="logout" class="btn btn-outline-danger">
      <i class="bi bi-box-arrow-right"></i> Logout
    </button>
  </div>
</div>

<!-- MODIFY: Update the setup() function to include logout functionality -->
<script>
const { createApp, ref, onMounted } = Vue;

createApp({
  setup() {
    // ADD: Current user state for displaying username
    const currentUser = ref({ username: 'Loading...' });

    const form = ref({
      dog_id: '',
      requested_time: '',
      duration_minutes: '',
      location: ''
    });

    const walks = ref([]);
    const message = ref('');
    const error = ref('');

    // ADD: Function to check if user is logged in
    async function checkAuth() {
      try {
        const response = await fetch('/api/users/me');
        if (response.ok) {
          const user = await response.json();
          currentUser.value = user;

          // Redirect if not an owner
          if (user.role !== 'owner') {
            window.location.href = '/walker-dashboard.html';
          }
        } else {
          // Not logged in, redirect to login
          window.location.href = '/';
        }
      } catch (err) {
        console.error('Auth check failed:', err);
        window.location.href = '/';
      }
    }

    // ADD: Logout function
    async function logout() {
      try {
        const response = await fetch('/api/users/logout', {
          method: 'POST',
          credentials: 'same-origin' // Ensure cookies are sent
        });

        if (response.ok) {
          // Clear any local storage if used
          localStorage.clear();
          sessionStorage.clear();

          // Redirect to login page
          window.location.href = '/';
        } else {
          error.value = 'Logout failed';
        }
      } catch (err) {
        console.error('Logout error:', err);
        error.value = 'Logout failed';
      }
    }

    async function loadWalks() {
      try {
        const res = await fetch('/api/walks');
        walks.value = await res.json();
      } catch (err) {
        error.value = 'Failed to load walk requests';
      }
    }

    async function submitWalkRequest() {
      try {
        const res = await fetch('/api/walks', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(form.value)
        });
        const result = await res.json();

        if (!res.ok) throw new Error(result.error || 'Error submitting walk request');

        message.value = result.message;
        error.value = '';
        form.value = {
          dog_id: '',
          requested_time: '',
          duration_minutes: '',
          location: ''
        };
        loadWalks();
      } catch (err) {
        error.value = err.message;
        message.value = '';
      }
    }

    onMounted(() => {
      checkAuth(); // ADD: Check authentication on page load
      loadWalks();
    });

    return {
      currentUser, // ADD: Expose current user for template
      form,
      walks,
      message,
      error,
      submitWalkRequest,
      logout // ADD: Expose logout function
    };
  }
}).mount('#app');
</script>